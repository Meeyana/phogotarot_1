---
// 1. IMPORT (Thêm BaseLayout)
import BaseLayout from '../layouts/BaseLayout.astro'; // (Giả sử đường dẫn layout)

// --- (MỚI) THÊM ĐOẠN NÀY ĐỂ LẤY DATA BLOG ---
import { getCollection } from "astro:content";

// Lấy tất cả bài viết trong collection 'blog'
const allPosts = await getCollection("blog");

// Sắp xếp bài viết: Mới nhất lên đầu
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Chỉ lấy 3 bài đầu tiên
const recentPosts = sortedPosts.slice(0, 3);

// 2. (SỬA LẠI) TẠO CÁC BIẾN VÀ SCHEMA
const pageTitle = "Phở Gõ Tarot - Trải Bài Tarot Miễn Phí & Luận Giải Sâu Sắc";
const pageDesc = "Khám phá ý nghĩa các lá bài tarot, nhận trải bài 3 lá, Yes/No miễn phí. Phở Gõ Tarot soi sáng con đường của bạn bằng luận giải sâu sắc.";

const schema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Phở Gõ Tarot",
  "url": "https://phogotarot.com/",
  "publisher": {
    "@type": "Organization",
    "name": "Phở Gõ Tarot",
    "logo": {
      "@type": "ImageObject",
      "url": "https://phogotarot.com/images/logo.png" // [cite: 6]
    }
  }
};
---

<BaseLayout
  title={pageTitle}
  description={pageDesc}
>    
    
    <main id="homepage-content">

        <section id="home" class="homepage-section" style="padding-top: 3rem; min-height: 80vh; display: flex; align-items: center;">
            <div class="container">
                <div class="grid-2">
                    <div class="text-center" style="md:text-align: left;">
                        <h2 class="hero-title">Phở Gõ Tarot</h2>
                        <p class="section-text" style="font-size: 1.25rem; margin-bottom: 2rem;">
                            Chào mừng bạn đến với Phở Gõ Tarot, không gian dành riêng cho những ai tìm kiếm sự khai sáng qua lăng kính Tarot huyền bí. Chúng tôi mang đến trải nghiệm Tarot online miễn phí mộc mạc, như một tô phở gõ vỗ về tâm hồn, giúp bạn giải đáp những khúc mắc trong tình cảm, công việc và cuộc sống. Hãy khám phá xem vũ trụ đang "gõ cửa" muốn nhắn nhủ điều gì với bạn và để Phở Gõ Tarot giải mã những thông điệp ấy.
                        </p>
                        <a href="/tarot" class="btn-primary">Xem Tarot Ngay</a>
                    </div>
                    <div style="display:flex;">
                        <div class="spinning-wheel-container">
                            <img src="/wheel.png" alt="Vòng tròn Zodiac" class="section-image spinning-wheel">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="container"><div class="divider"></div></div>

        <section id="about" class="homepage-section">
            <div class="container">
                <div class="grid-2">
                    <div>
                        <img src="/img-1.jpg" alt="Tarot Reader" class="section-image">
                    </div>
                    <div class="text-center" style="md:text-align: left;">
                        <h2 class="section-subtitle">Tarot Là Gì?</h2>
                        <p class="section-text text-left">
                            Tarot là một bộ 78 lá bài, mỗi lá mang một ý nghĩa biểu tượng riêng. Nó không phải để dự đoán tương lai một cách chính xác, mà là một công cụ để tự suy ngẫm, khám phá bản thân và cung cấp một góc nhìn mới về các tình huống trong cuộc sống.
                        </p>
                        <p class="section-text text-left">
                            Một buổi đọc bài tarot có thể giúp bạn hiểu rõ hơn về những thách thức, cơ hội và tiềm năng ẩn giấu bên trong bạn.
                        </p>
                        <a href="#contact" class="btn-outline">Đặt Lịch Đọc Bài</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="services" class="homepage-section bg-alt">
            <div class="container">
                <h2 class="section-title">Các Tính Năng Trải Bài</h2>
                <div class="grid-3">
                    <div class="service-card">
                        <h3 class="section-subtitle" style="font-size: 1.5rem;">Trải Bài 3 Lá</h3>
                        <p class="section-text" style="font-size: 0.9rem;">Nhận một cái nhìn tổng quan về Tình yêu, Sự nghiệp hoặc một câu hỏi cụ thể. Một trải bài nhanh chóng và sâu sắc.</p>
                        <a href="/tarot" class="btn-outline" style="font-size: 0.9rem; margin-top: 1.5rem;">Nhận thông điệp</a>
                    </div>
                    
                    <div class="service-card">
                        <h3 class="section-subtitle" style="font-size: 1.5rem;">Câu Hỏi Yes/No</h3>
                        <p class="section-text" style="font-size: 0.9rem;">Cần một câu trả lời nhanh và rõ ràng? Rút một lá bài để nhận được hướng dẫn 'Có' hoặc 'Không' cho vấn đề của bạn.</p>
                        <a href="/yes-no-reading" class="btn-outline" style="font-size: 0.9rem; margin-top: 1.5rem;">Nhận thông điệp</a>
                    </div>
                    
                    <div class="service-card">
                        <h3 class="section-subtitle" style="font-size: 1.5rem;">Zodiac Tarot</h3>
                        <p class="section-text" style="font-size: 0.9rem;">Khám phá lá bài đại diện cho cung hoàng đạo của bạn hôm nay và nhận thông điệp đặc biệt từ vũ trụ.</p>
                        <a href="/zodiac-daily" class="btn-outline" style="font-size: 0.9rem; margin-top: 1.5rem;">Nhận thông điệp</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="blog" class="homepage-section">
            <div class="container">
                <h2 class="section-title">Bài Viết Mới</h2>
                
                <div class="grid-3">
                    {/* Bắt đầu vòng lặp lấy 3 bài viết */}
                    {recentPosts.map((post) => (
                        <div class="blog-card mdf-blog">
                            {/* Hiển thị ảnh bài viết */}
                            <img 
                                src={post.data.image} 
                                alt={post.data.title} 
                                class="section-image"
                                style="object-fit: cover;" 
                            />
                            
                            {/* Tiêu đề bài viết */}
                            <h3 class="section-subtitle" style="font-size: 1.25rem; text-align: left; padding: 0 1rem;">
                                {post.data.title}
                            </h3>
                            
                            {/* Mô tả ngắn (nếu có) */}
                            <p class="section-text" style="font-size: 0.9rem; text-align: left; opacity: 0.8; padding: 0 1rem;">
                                {post.data.excerpt}
                            </p>
                            
                            {/* Link đến bài viết chi tiết */}
                            <a href={`/blog/${post.slug}`} class="btn-outline" style="font-size: 0.9rem; float: left; margin: 0 1rem 1rem;">
                                Đọc tiếp &rarr;
                            </a>
                        </div>
                    ))}
                </div>
                
            </div>
        </section>

        <section id="faq" class="homepage-section">
            <div class="container">
                <h2 class="section-title">Thắc Mắc Thường Gặp</h2>
                
                <div class="faq-container">
                    <details class="faq-item">
                        <summary class="faq-question">Xem Tarot online có chính xác như xem trực tiếp không?</summary>
                        <div class="faq-answer">
                            <p>Hoàn toàn chính xác. Tarot kết nối dựa trên năng lượng và trực giác, những yếu tố này không bị giới hạn bởi khoảng cách vật lý hay màn hình điện thoại. Chỉ cần bạn tập trung và mở lòng, thông điệp gửi đến bạn vẫn sẽ trọn vẹn.</p>
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary class="faq-question">Mình chưa biết nên hỏi gì thì có xem được không?</summary>
                        <div class="faq-answer">
                            <p>Đừng lo nhé! Nếu bạn đang rối bời, Reader của Phở Gõ sẽ giúp bạn gỡ rối và định hình câu hỏi. Chúng mình cũng có những trải bài tổng quan để bạn nắm bắt tình hình chung mà không cần câu hỏi cụ thể.</p>
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary class="faq-question">Thông tin câu chuyện của mình có được bảo mật không?</summary>
                        <div class="faq-answer">
                            <p>Tuyệt đối bảo mật. Mọi chia sẻ của bạn với Phở Gõ Tarot đều được giữ kín như "công thức gia truyền". Chúng mình tôn trọng sự riêng tư tuyệt đối của mọi khách hàng.</p>
                        </div>
                    </details>
                    
                     <details class="faq-item">
                        <summary class="faq-question">Làm sao để đặt lịch xem bài?</summary>
                        <div class="faq-answer">
                            <p>Bạn chỉ cần bấm vào nút "Đặt lịch tư vấn" bên dưới hoặc nhắn tin trực tiếp qua Fanpage. Tụi mình sẽ phản hồi và sắp xếp khung giờ phù hợp nhất cho bạn ngay lập tức.</p>
                        </div>
                    </details>
                </div>

            </div>
        </section>

        <section id="oracle" class="homepage-section bg-alt">
            <div class="container">
                <div class="grid-2">
                    <div class="text-center" style="md:text-align: left;">
                        <h2 class="section-subtitle">Cần tư vấn từ chuyên gia?</h2>
                        <p class="section-text text-left">
                            Nếu trong quá trình đọc bài bạn vẫn còn điều gì băn khoăn hoặc muốn được giải thích chi tiết hơn, cứ thoải mái liên hệ với Phở Gõ nhé. Chúng mình luôn sẵn sàng hỗ trợ để bạn hiểu rõ vấn đề một cách nhanh chóng và chính xác nhất.
                        </p>
                        <a href="/contact" class="btn-primary">Đặt lịch tư vấn</a>
                    </div>
                    <div>
                        <img src="/img-2.jpg" alt="Oracle Cards" class="section-image">
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <style>
        #stars-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        #stars-bg::after {
            content: '';
            position: absolute;
            top: 10%;
            right: 15%;
            width: 50px; 
            height: 50px;
            border-radius: 50%;
            box-shadow: -10px 5px 0 0px var(--text-color);
            opacity: 0.5;
            animation: moon-glow 10s ease-in-out infinite alternate;
        }
        #stars-bg::before {
            content: '';
            position: absolute;
            bottom: 5%;
            left: 10%;
            width: 200px;
            height: 100px;
            background: radial-gradient(ellipse at center, rgba(142, 186, 255, 0.15) 0%, rgba(142, 186, 255, 0) 70%);
            border-radius: 50%;
            transform: rotate(-30deg);
            opacity: 0.5;
            animation: moon-glow 15s ease-in-out infinite alternate;
        }
        .star {
            position: absolute;
            border-radius: 50%;
            background: white;
            opacity: 0.6;
            animation: twinkle 3s infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }
         @keyframes moon-glow {
            from { opacity: 0.3; transform: rotate(-5deg); }
            to { opacity: 0.6; transform: rotate(5deg); }
        }

        /* --- (MỚI) CSS CHO BỐ CỤC TRANG CHỦ --- */
        .homepage-section {
            padding: 4rem 1rem;
            position: relative; /* Để nằm trên nền sao */
            z-index: 1;
            width: 100%;
        }
        /* Dùng màu nền mờ cho một số section */
        .homepage-section.bg-alt {
            border-radius: 12px;
            margin: 2rem auto;
            max-width: 1200px;
        }
        .container {
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            align-items: center;
        }
        @media (min-width: 768px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 768px) {
            .grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .grid-4 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 640px) {
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (min-width: 1024px) {
            .grid-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .text-center { text-align: center; }
        .text-left { text-align: left; }
        
        /* Tiêu đề chính (to nhất) */
        .hero-title {
            font-family: var(--font-title);
            color: var(--title-color);
            font-size: clamp(2.5rem, 7vw, 4rem);
            text-shadow: 0 0 20px rgb(142 186 255), 0 0 8px rgba(142 186 255, 0.8);
            margin-bottom: 1.5rem;
        }
        /* Tiêu đề các mục */
        .section-title {
            font-family: var(--font-title);
            color: var(--title-color);
            font-size: clamp(2rem, 6vw, 3rem);
            text-shadow: 0 0 20px rgb(142 186 255), 0 0 8px rgba(142 186 255, 0.8);
            margin-bottom: 3rem;
            text-align: center;
        }
        /* Tiêu đề phụ (nhỏ hơn) */
        .section-subtitle {
            font-family: var(--font-title);
            color: var(--title-color);
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            text-shadow: 0 0 15px rgba(142, 186, 255, 0.8), 0 0 5px rgba(142, 186, 255, 0.6);
            margin-bottom: 1.5rem;
        }
        /* Văn bản thường */
        .section-text {
            font-size: 1.1rem;
            line-height: 1.7;
            opacity: 0.9;
            margin-bottom: 1.5rem;
            text-shadow: none; /* Xóa shadow cho dễ đọc */
        }

        /* Nút bấm (style giống nút 'Xem ý nghĩa') */
        .btn-primary {
            display: inline-block;
            background-color: var(--title-color);
            color: var(--bg-color);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-shadow: none;
        }
        .btn-primary:hover {
            background-color: #b8d4ff;
        }
        /* Nút viền (style giống nút 'Chia sẻ') */
        .btn-outline {
            display: inline-block;
            background-color: transparent;
            border: 1px solid var(--card-back-border);
            color: var(--title-color);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: var(--font-body);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-shadow: none;
        }
        .btn-outline:hover {
            background-color: var(--button-hover-bg);
        }

        /* Thẻ Dịch vụ, Thẻ Blog */
        .service-card, .blog-card {
            border: 1px solid var(--card-back-border);
            background-color: var(--button-bg);
            padding: 1.5rem;
            border-radius: 12px;
            transition: all 0.3s;
            text-align: center;
            height: 100%; /* (MỚI) Cho các thẻ cao bằng nhau */
        }
        .service-card:hover, .blog-card:hover {
            box-shadow: 0 0 20px var(--card-back-border);
            transform: translateY(-5px);
        }
        .service-card .service-price {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 1rem 0 1.5rem;
        }
        /* Hình ảnh */
        .section-image {
            width: 100%;
            height: auto;
            border-radius: 12px 12px 0 0;
            object-fit: cover;
            border: 1px solid var(--card-back-border);
        }
        .blog-card .section-image {
            height: 200px; /* Cố định chiều cao ảnh blog */
            margin-bottom: 1.5rem;
        }
        .blog-card .section-subtitle { text-align: left; }
        .blog-card .section-text { text-align: left; opacity: 0.8; }
        .blog-card .btn-outline { float: left; }

        /* Đường kẻ ngang */
        .divider {
            height: 1px;
            background-color: var(--card-back-border);
            opacity: 0.5;
            margin: 2rem 0;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        /* === (MỚI) CSS KHẮC PHỤC LỖI VÒNG XOAY === */
        .spinning-wheel-container {
            /* Lấy lại style từ inline của img cũ  */
            max-width: 550px;
            margin: auto;
            
            /* Đảm bảo wrapper luôn là hình vuông
              (Responsive: width 100% của cột, nhưng không bao giờ rộng hơn 400px)
            */
            width: 100%; 
            aspect-ratio: 1 / 1; /* Giữ tỷ lệ 1:1 (vuông) */

            /* === Đây là 2 chìa khóa quan trọng: === */
            
            /* 1. Biến wrapper thành hình tròn */
            border-radius: 50%; 
            
            /* 2. Cắt bỏ mọi thứ bị thừa ra ngoài (quan trọng nhất!) */
            overflow: hidden;   
        }

        /* Ghi đè lại class .section-image [cite: 76]
          khi nó nằm BÊN TRONG wrapper.
          Chúng ta không muốn nó có border hay border-radius 12px nữa.
        */
        .spinning-wheel-container .section-image {
            border-radius: 0;
            border: none;
        }
        
        /* === (MỚI) CSS CHO HIỆU ỨNG XOAY === */
        @keyframes spin-clockwise {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .spinning-wheel {
            animation: spin-clockwise 20s linear infinite;
        }
        /* === (HẾT) CSS CHO HIỆU ỨNG XOAY === */

        .mdf-blog{
            padding: 0 !important;
        }

        .mdf-sub{
            padding: 0 1rem !important;
        }

        /* === STYLE CHO FAQ === */
        .faq-container {
            max-width: 800px; /* Giới hạn chiều rộng cho dễ đọc */
            margin: 0 auto;
        }

        .faq-item {
            background-color: var(--button-bg); /* Nền tối giống thẻ Card */
            border: 1px solid var(--card-back-border); /* Viền mỏng */
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .faq-item:hover {
            box-shadow: 0 0 15px rgba(142, 186, 255, 0.2);
            border-color: var(--title-color);
        }

        /* Phần câu hỏi (luôn hiện) */
        .faq-question {
            padding: 1.2rem 1.5rem;
            font-family: var(--font-title); /* Font tiêu đề cho sang */
            font-size: 1.1rem;
            color: var(--title-color); /* Màu chữ tiêu đề */
            cursor: pointer;
            list-style: none; /* Ẩn dấu tam giác mặc định */
            position: relative;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Tạo dấu cộng (+) tùy chỉnh */
        .faq-question::after {
            content: '+'; 
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--title-color);
            transition: transform 0.3s ease;
        }

        /* Khi mở ra thì xoay dấu cộng thành dấu nhân (x) */
        details[open] .faq-question::after {
            transform: rotate(45deg);
        }

        /* Ẩn dấu tam giác mặc định trên một số trình duyệt */
        .faq-question::-webkit-details-marker {
            display: none;
        }

        /* Phần câu trả lời (ẩn/hiện) */
        .faq-answer {
            padding: 0 1.5rem 1.5rem 1.5rem;
            color: var(--text-color);
            font-size: 1rem;
            line-height: 1.6;
            opacity: 0.9;
            border-top: 1px solid rgba(142, 186, 255, 0.1); /* Đường kẻ mờ ngăn cách */
            margin-top: 0;
            padding-top: 1rem;
        }
        
        /* Hiệu ứng xuất hiện nhẹ nhàng */
        details[open] .faq-answer {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 0.9; transform: translateY(0); }
        }
               
    </style>
</BaseLayout>