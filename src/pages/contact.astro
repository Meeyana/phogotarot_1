---
// 1. IMPORT
import BaseLayout from '../layouts/BaseLayout.astro';

// 2. TẠO METADATA VÀ SCHEMA
const pageTitle = "Liên Hệ & Đặt Lịch | Phở Gõ Tarot";
const pageDesc = "Liên hệ với Phở Gõ Tarot để đặt lịch trải bài cá nhân hoặc gửi góp ý. Chúng tôi luôn sẵn sàng lắng nghe bạn.";
const pageUrl = new URL('/contact', Astro.site).href;

const schema = {
  "@context": "https://schema.org",
  "@type": "ContactPage",
  "name": pageTitle,
  "description": pageDesc,
  "url": pageUrl,
  "mainEntity": {
    "@type": "Organization",
    "name": "Phở Gõ Tarot",
    "email": "contact@phogotarot.com",
    "telephone": "+84352677543",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Quận Bình Thạnh",
      "addressRegion": "Hồ Chí Minh",
      "addressCountry": "VN"
    }
  },
  "isPartOf": {
    "@type": "WebSite",
    "url": Astro.site ? Astro.site.href : "https://phogotarot.com/"
  }
};
---

<BaseLayout
  title={pageTitle}
  description={pageDesc}
>
    <!-- Font Awesome -->
    <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" 
      xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
      crossorigin="anonymous" 
      referrerpolicy="no-referrer" 
      slot="head" 
    />

    <main id="contact-content">
        <section class="homepage-section" style="padding-top: 4rem; min-height: 80vh;">
            <div class="container">
                
                <!-- TIÊU ĐỀ LỚN -->
                <div class="section-header">
                    <h2 class="section-title">Liên Hệ & Đặt Lịch</h2>
                </div>
                
                <div class="contact-layout-grid">
                    
                    <!-- CỘT TRÁI: THÔNG TIN -->
                    <div class="contact-info-col">
                        <h3 class="section-subtitle">Thông tin liên hệ</h3>
                        <p class="section-text">
                            Kết nối với vũ trụ Tarot hoặc gửi lời nhắn cho chúng tôi qua các kênh dưới đây.
                        </p>
                        
                        <ul class="contact-info-list">
                            <li>
                                <div class="icon-wrapper">
                                    <i class="fa-solid fa-envelope"></i>
                                </div>
                                <div>
                                    <strong>Email</strong>
                                    <a href="mailto:contact@phogotarot.com">contact@phogotarot.com</a>
                                </div>
                            </li>
                            <li>
                                <div class="icon-wrapper">
                                    <i class="fa-solid fa-phone"></i>
                                </div>
                                <div>
                                    <strong>Điện thoại</strong>
                                    <a href="tel:0352677543">0352 677 543</a>
                                </div>
                            </li>
                            <li>
                                <div class="icon-wrapper">
                                    <i class="fa-solid fa-location-dot"></i>
                                </div>
                                <div>
                                    <strong>Địa chỉ</strong>
                                    <span>Quận Bình Thạnh, Hồ Chí Minh, VN</span>
                                </div>
                            </li>
                        </ul>

                        <!-- ICON MẠNG XÃ HỘI (ĐÃ CHỈNH SỬA: ĐƠN GIẢN & GLOW) -->
                        <div class="contact-social-links">
                            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook" class="social-btn">
                                <i class="fa-brands fa-facebook"></i>
                            </a>
                            <a href="https://www.instagram.com/pho_go_tarot/" target="_blank" rel="noopener noreferrer" aria-label="YouTube" class="social-btn">
                                <i class="fa-brands fa-youtube"></i>
                            </a>
                            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="social-btn">
                                <i class="fa-brands fa-instagram"></i>
                            </a>
                            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="TikTok" class="social-btn">
                                <i class="fa-brands fa-tiktok"></i>
                            </a>
                        </div>
                        
                        <div class="feedback-box">
                            <h4 class="feedback-title">Góc Lắng Nghe</h4>
                            <p class="section-text" style="font-size: 0.95rem; margin-bottom: 0; color: #ddd;">
                                Mỗi góp ý của bạn là một lá bài dẫn lối để Phở Gõ Tarot hoàn thiện hơn. Đừng ngần ngại chia sẻ cảm nhận của bạn nhé.
                            </p>
                        </div>
                    </div>
                    
                    <!-- CỘT PHẢI: FORM ĐẶT LỊCH -->
                    <div class="contact-form-col">
                        <h3 class="section-subtitle form-header">Đặt lịch trải bài</h3>
                        
                        <form 
                            action="https://docs.google.com/forms/d/e/1FAIpQLSfQtaTjRoXJQHW49oL0fOvOcckGvGwR53oghw5JTMsK78k33w/formResponse" 
                            method="POST" 
                            target="hidden_iframe"
                            id="contact-form"
                        >
                            <div class="form-row">
                                <div class="form-group half-width">
                                    <label for="name" class="form-label">Tên của bạn <span class="required">*</span></label>
                                    <input type="text" id="name" name="entry.1759243586" class="form-input" placeholder="Nhập tên" required>
                                </div>
                                
                                <div class="form-group half-width">
                                    <label for="birth-year" class="form-label">Năm sinh <span class="required">*</span></label>
                                    <input type="number" id="birth-year" name="entry.1886627318" class="form-input" placeholder="YYYY" required min="1920" max="2007">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="email" class="form-label">Email <span class="required">*</span></label>
                                <input type="email" id="email" name="entry.240015486" class="form-input" placeholder="example@gmail.com" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group half-width">
                                    <label for="phone" class="form-label">Điện thoại (Tùy chọn)</label>
                                    <input type="tel" id="phone" name="entry.1415567726" class="form-input" placeholder="Số ĐT">
                                </div>

                                <div class="form-group half-width">
                                    <label for="instagram" class="form-label">Instagram (Tùy chọn)</label>
                                    <input type="text" id="instagram" name="entry.1804120934" class="form-input" placeholder="@username">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="question" class="form-label">Câu chuyện của bạn (Tùy chọn)</label>
                                <textarea id="question" name="entry.171600570" class="form-textarea" rows="3" placeholder="Bạn đang băn khoăn về vấn đề gì?"></textarea>
                            </div>
                            
                            <button type="submit" class="btn-submit" id="submit-button">
                                <i class="fa-solid fa-paper-plane"></i> Gửi Đăng Ký
                            </button>
                            
                            <div id="form-success-message" class="form-status-message success">
                                <i class="fa-solid fa-check-circle"></i> Gửi thành công!
                            </div>
                            <div id="form-error-message" class="form-status-message error">
                                <i class="fa-solid fa-circle-exclamation"></i> Lỗi. Thử lại sau.
                            </div>
                        </form>
                        
                        <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

                        <!-- LƯU Ý QUAN TRỌNG -->
                        <div class="disclaimer-note">
                            <strong>Lưu ý quan trọng:</strong>
                            <p>Phở Gõ Tarot không nhận trải bài cho các chủ đề sau: Sức khỏe, Bệnh tật, Pháp lý, Thi cử, Trúng số, hoặc các vấn đề 18+.</p>
                            <p>Dịch vụ cũng không dành cho người dưới 18 tuổi. Cảm ơn bạn đã thấu hiểu.</p>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </main>
    
    <script type="application/ld+json" slot="head" set:html={JSON.stringify(schema)} />

    <script is:inline>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('contact-form');
            const iframe = document.getElementById('hidden_iframe');
            const successMessage = document.getElementById('form-success-message');
            const errorMessage = document.getElementById('form-error-message');
            const submitButton = document.getElementById('submit-button');
            const phoneInput = document.getElementById('phone');
            const instagramInput = document.getElementById('instagram');
            let formSubmitted = false;

            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/[^\d]/g, '');
                });
            }

            if (form) {
                form.addEventListener('submit', function(event) {
                    errorMessage.style.display = 'none';
                    const instagramValue = instagramInput.value.trim();
                    if (instagramValue.length > 0) {
                        if (!instagramValue.startsWith('@')) {
                            instagramInput.value = '@' + instagramValue;
                        } else if (instagramValue.length === 1 && instagramValue === '@') {
                            instagramInput.value = '';
                        }
                    }
                    submitButton.disabled = true;
                    submitButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Đang gửi...';
                    formSubmitted = true;
                    successMessage.style.display = 'none';
                    const errorTimeout = setTimeout(showError, 8000);
                    iframe.onload = function() {
                        if (formSubmitted) {
                            clearTimeout(errorTimeout);
                            showSuccess();
                        }
                    };
                });
            }

            function showSuccess() {
                successMessage.style.display = 'block';
                form.reset();
                resetButton();
                formSubmitted = false;
            }

            function showError() {
                if (errorMessage.style.display !== 'block') {
                    errorMessage.style.display = 'block';
                }
                resetButton();
                formSubmitted = false;
            }
            
            function resetButton() {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Gửi Đăng Ký';
            }
        });
    </script>

    <style>
        /* === 1. LAYOUT CHUNG === */
        .homepage-section { padding: 4rem 1rem; position: relative; }
        .container { max-width: 1200px; margin: auto; padding: 0 1rem; }

        /* === 2. TYPOGRAPHY === */
        .section-header { margin-bottom: 3rem; }
        .section-title { 
            font-family: var(--font-title); color: #ffffff; font-size: 3rem; font-weight: 700; margin: 0; text-align: left;
            text-shadow: 0 0 10px rgba(242, 201, 76, 0.5), 0 0 40px rgba(242, 201, 76, 0.1);
        }
        .section-subtitle { 
            font-family: var(--font-title); color: var(--gold-color, #F2C94C); 
            font-size: 1.8rem; margin-top: 0; margin-bottom: 1.5rem;
            text-shadow: 0 0 15px rgba(242, 201, 76, 0.3);
        }
        .section-text { font-size: 1rem; opacity: 0.9; margin-bottom: 2rem; line-height: 1.6; color: #ddd; text-shadow: none; }
        
        /* === 3. GRID LAYOUT === */
        .contact-layout-grid { display: grid; grid-template-columns: 1fr; gap: 3rem; }
        @media (min-width: 900px) { .contact-layout-grid { grid-template-columns: 1fr 1.2fr; } }
        
        /* === 4. INFO COLUMN === */
        .contact-info-col { padding-right: 1rem; }
        .contact-info-list { list-style: none; padding: 0; margin: 2rem 0; display: flex; flex-direction: column; gap: 2rem; }
        .contact-info-list li { display: flex; align-items: center; gap: 1.2rem; }
        .icon-wrapper {
            width: 50px; height: 50px; border-radius: 50%; border: 1px solid var(--gold-color, #F2C94C);
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: var(--gold-color, #F2C94C);
            background: rgba(242, 201, 76, 0.05); box-shadow: 0 0 15px rgba(242, 201, 76, 0.2); flex-shrink: 0; transition: all 0.3s;
        }
        .contact-info-list li:hover .icon-wrapper { background: var(--gold-color, #F2C94C); color: #050A1F; box-shadow: 0 0 20px rgba(242, 201, 76, 0.5); }
        .contact-info-list li strong { font-size: 0.85rem; opacity: 0.6; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 0.3rem; }
        .contact-info-list li a, .contact-info-list li span { font-size: 1.1rem; font-weight: 600; color: #fff; text-decoration: none; transition: color 0.3s; }
        .contact-info-list li a:hover { color: var(--gold-color, #F2C94C); }

        /* === SOCIAL BUTTONS (SIMPLE GLOW STYLE) === */
        .contact-social-links { display: flex; gap: 2rem; margin-bottom: 3rem; align-items: center; }
        .social-btn {
            /* Bỏ border và background tròn, chỉ giữ icon */
            display: flex; align-items: center; justify-content: center;
            color: rgba(255, 255, 255, 0.8); /* Màu trắng mờ */
            font-size: 2rem; /* Icon to hơn */
            text-decoration: none; 
            transition: all 0.3s ease;
            width: auto; height: auto;
            border: none; background: transparent; border-radius: 0;
        }
        .social-btn:hover {
            transform: translateY(-3px);
            color: #fff; /* Chuyển sang trắng tinh */
            /* Hiệu ứng phát sáng màu trắng (White Glow) */
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.3);
            box-shadow: none;
            border-color: transparent;
        }

        .feedback-box {
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 1.5rem; backdrop-filter: blur(10px);
        }
        .feedback-title { font-family: var(--font-title); color: #fff; font-size: 1.2rem; margin-top: 0; margin-bottom: 0.5rem; }

        /* === 5. FORM COLUMN === */
        .contact-form-col {
            background: rgba(11, 19, 43, 0.6); 
            border: 1px solid rgba(242, 201, 76, 0.3); 
            border-radius: 16px; 
            padding: 1.5rem; 
            backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        }
        .contact-form-col::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, transparent, var(--gold-color, #F2C94C), transparent); opacity: 0.5;
        }
        
        .form-header { font-size: 1.4rem; margin-bottom: 1rem; text-align: center; color: var(--gold-color, #F2C94C); }
        
        .form-row { display: flex; gap: 1rem; }
        .half-width { flex: 1; }

        .form-group { margin-bottom: 0.8rem; }
        
        .form-label { display: block; font-weight: 600; font-size: 0.85rem; margin-bottom: 0.2rem; color: #ccc; }
        .form-label .required { color: var(--gold-color, #F2C94C); }
        
        .form-input, .form-textarea {
            width: 100%; 
            padding: 0.6rem 0.8rem; 
            border-radius: 6px; background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1); color: #fff; font-family: var(--font-body); font-size: 0.9rem; transition: all 0.3s;
        }
        .form-input::placeholder, .form-textarea::placeholder { color: rgba(255,255,255,0.3); font-size: 0.85rem; }
        
        .form-input:focus, .form-textarea:focus {
            outline: none; border-color: var(--gold-color, #F2C94C); background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(242, 201, 76, 0.1);
        }
        .form-textarea { resize: vertical; }
        
        .btn-submit {
            display: inline-flex; alignItems: center; justify-content: center; gap: 0.75rem;
            background: linear-gradient(135deg, #D4AF37 0%, #F2C94C 50%, #FFD700 100%);
            color: #050A1F; border: none; 
            padding: 0.7rem 2rem; 
            border-radius: 50px; font-family: var(--font-body); font-size: 1rem; font-weight: 700;
            cursor: pointer; transition: all 0.3s; width: 100%; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); margin-top: 0.5rem;
        }
        .btn-submit:hover {
            transform: translateY(-2px); box-shadow: 0 6px 20px rgba(242, 201, 76, 0.6);
            background: linear-gradient(135deg, #FFF 0%, #FFD700 50%, #F2C94C 100%);
        }
        .btn-submit:disabled { opacity: 0.7; cursor: not-allowed; filter: grayscale(1); }

        .disclaimer-note {
            font-size: 0.85rem; color: #ccc;
            border-left: 3px solid var(--gold-color, #F2C94C);
            margin-top: 1.5rem; line-height: 1.5;
            background: rgba(242, 201, 76, 0.05);
            padding: 0.8rem; border-radius: 0 8px 8px 0;
        }
        .disclaimer-note strong { color: var(--gold-color, #F2C94C); display: block; margin-bottom: 0.3rem; font-size: 0.9rem;}
        .disclaimer-note p { margin: 0 0 0.3rem 0; }
        .disclaimer-note p:last-child { margin-bottom: 0; }

        /* Messages */
        .form-status-message { display: none; padding: 0.8rem; border-radius: 8px; margin-top: 1rem; font-weight: 600; text-align: center; font-size: 0.9rem; }
        .form-status-message.success { background-color: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; color: #22c55e; }
        .form-status-message.error { background-color: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #ef4444; }
        
        @media (max-width: 600px) {
            .section-title { font-size: 2.5rem; }
            .contact-form-col { padding: 1rem; }
            .form-row { flex-direction: column; gap: 0; } 
        }
    </style>
</BaseLayout>