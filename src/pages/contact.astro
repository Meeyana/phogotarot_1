---
// 1. IMPORT
import BaseLayout from '../layouts/BaseLayout.astro';

// 2. TẠO METADATA VÀ SCHEMA
const pageTitle = "Liên Hệ & Đặt Lịch | Phở Gõ Tarot";
const pageDesc = "Liên hệ với Phở Gõ Tarot để đặt lịch trải bài cá nhân hoặc gửi góp ý. Chúng tôi luôn sẵn sàng lắng nghe bạn.";
const pageUrl = new URL('/contact', Astro.site).href;

const schema = {
  "@context": "https://schema.org",
  "@type": "ContactPage",
  "name": pageTitle,
  "description": pageDesc,
  "url": pageUrl,
  "mainEntity": {
    "@type": "Organization",
    "name": "Phở Gõ Tarot",
    "email": "contact@phogotarot.com",
    "telephone": "+84352677543",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Quận Bình Thạnh",
      "addressRegion": "Hồ Chí Minh",
      "addressCountry": "VN"
    }
  },
  "isPartOf": {
    "@type": "WebSite",
    "url": Astro.site ? Astro.site.href : "https://phogotarot.com/"
  }
};
---

<BaseLayout
  title={pageTitle}
  description={pageDesc}
>
    <!-- Thêm Font Awesome cho các icon trong trang này -->
    <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" 
      xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
      crossorigin="anonymous" 
      referrerpolicy="no-referrer" 
      slot="head" 
    />

    <main id="contact-content">
        <section class="homepage-section" style="padding-top: 6rem; min-height: 80vh;">
            <div class="container">
                <h2 class="section-title" style="text-align: left; margin-bottom: 3rem;">
                    Liên Hệ & Đặt Lịch
                </h2>
                
                <div class="contact-layout-grid">
                    
                    <!-- CỘT BÊN TRÁI: THÔNG TIN & GÓP Ý -->
                    <div class="contact-info-col">
                        <h3 class="section-subtitle">Thông tin liên hệ</h3>
                        <p class="section-text">
                            Bạn có thể liên hệ trực tiếp với chúng tôi qua các kênh dưới đây.
                        </p>
                        
                        <ul class="contact-info-list">
                            <li>
                                <i class="fa-solid fa-envelope info-icon"></i>
                                <div>
                                    <strong>Email</strong>
                                    <a href="mailto:contact@phogotarot.com">contact@phogotarot.com</a>
                                </div>
                            </li>
                            <li>
                                <i class="fa-solid fa-phone info-icon"></i>
                                <div>
                                    <strong>Điện thoại</strong>
                                    <a href="tel:0352677543">0352 677 543</a>
                                </div>
                            </li>
                            <li>
                                <i class="fa-solid fa-location-dot info-icon"></i>
                                <div>
                                    <strong>Địa chỉ</strong>
                                    <span>Quận Bình Thạnh, Hồ Chí Minh, VN</span>
                                </div>
                            </li>
                        </ul>

                        <div class="contact-social-links">
                            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                                <i class="fa-brands fa-facebook"></i>
                            </a>
                            <a href="https://www.instagram.com/pho_go_tarot/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                                <i class="fa-brands fa-instagram"></i>
                            </a>
                            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
                                <i class="fa-brands fa-youtube"></i>
                            </a>
                            <a href="#" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
                                <i class="fa-brands fa-tiktok"></i>
                            </a>
                        </div>
                        
                        <div class="feedback-box">
                            <h4 class="feedback-title">Chúng tôi trân trọng ý kiến của bạn</h4>
                            <p class="section-text" style="font-size: 0.95rem; margin-bottom: 0;">
                                Mỗi góp ý của bạn là một sự trợ giúp quý giá để Phở Gõ Tarot ngày càng hoàn thiện. Nếu bạn có bất kỳ câu hỏi hoặc đề xuất nào, đừng ngần ngại chia sẻ. Chúng tôi sẽ đọc và phản hồi bạn trong thời gian sớm nhất.
                            </p>
                        </div>
                    </div>
                    
                    <!-- CỘT BÊN PHẢI: FORM ĐẶT LỊCH -->
                    <div class="contact-form-col">
                        <h3 class="section-subtitle">Đặt lịch trải bài cá nhân</h3>
                        
                        <!-- 
                        !!! QUAN TRỌNG:
                        1. Thay thế URL_GOOGLE_FORM bên dưới bằng link "action" của form bạn.
                           (Cách lấy: Mở Google Form -> Nút "Gửi" -> Tab "Liên kết" -> Lấy link)
                           NÓ PHẢI Ở ĐỊNH DẠNG ".../formResponse"
                           VÍ DỤ: https://docs.google.com/forms/d/e/1FAIpQLS.../formResponse
                           
                        2. Thay thế các "entry.XXXXXX" trong thuộc tính 'name' của mỗi input
                           bằng "entry ID" tương ứng từ Google Form của bạn.
                           (Cách lấy: Mở form -> Chuột phải vào ô input -> "Kiểm tra" (Inspect)
                           -> Tìm thuộc tính 'name' của input đó)
                        -->
                        <form 
                            action="URL_GOOGLE_FORM" 
                            method="POST" 
                            target="hidden_iframe"
                            id="contact-form"
                        >
                            <!-- Tên (Bắt buộc) -->
                            <div class="form-group">
                                <label for="name" class="form-label">Tên của bạn <span class="required">*</span></label>
                                <input type="text" id="name" name="entry.XXXXXX" class="form-input" required>
                            </div>
                            
                            <!-- Email (Bắt buộc) -->
                            <div class="form-group">
                                <label for="email" class="form-label">Email <span class="required">*</span></label>
                                <input type="email" id="email" name="entry.YYYYYY" class="form-input" required>
                            </div>
                            
                            <!-- Năm sinh (Bắt buộc) -->
                            <div class="form-group">
                                <label for="birth-year" class="form-label">Năm sinh <span class="required">*</span></label>
                                <input type="number" id="birth-year" name="entry.ZZZZZZ" class="form-input" placeholder="YYYY" required min="1920" max="2007">
                                <small class="form-hint">Chúng tôi cần xác nhận bạn trên 18 tuổi.</small>
                            </div>

                            <!-- Điện thoại (Tùy chọn) -->
                            <div class="form-group">
                                <label for="phone" class="form-label">Điện thoại (Tùy chọn)</label>
                                <input type="tel" id="phone" name="entry.AAAAAA" class="form-input">
                            </div>

                            <!-- Instagram (Tùy chọn) -->
                            <div class="form-group">
                                <label for="instagram" class="form-label">Instagram (Tùy chọn)</label>
                                <input type="text" id="instagram" name="entry.BBBBBB" class="form-input" placeholder="@username">
                            </div>
                            
                            <!-- Chủ đề (Tùy chọn) -->
                            <div class="form-group">
                                <label for="question" class="form-label">Chủ đề hoặc câu hỏi muốn hỏi (Tùy chọn)</label>
                                <textarea id="question" name="entry.CCCCCC" class="form-textarea" rows="5" placeholder="Bạn có thể mô tả ngắn gọn về vấn đề của mình..."></textarea>
                            </div>
                            
                            <!-- Nút Gửi -->
                            <button type="submit" class="btn-primary" id="submit-button">
                                <i class="fa-solid fa-paper-plane"></i> Gửi Đăng Ký
                            </button>
                            
                            <!-- Thông báo trạng thái -->
                            <div id="form-success-message" class="form-status-message success">
                                Gửi thành công! Chúng tôi sẽ liên hệ với bạn sớm nhất.
                            </div>
                            <div id="form-error-message" class="form-status-message error">
                                Đã xảy ra lỗi. Vui lòng thử lại.
                            </div>
                        </form>
                        
                        <!-- iFrame ẩn để xử lý form -->
                        <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

                        <!-- Disclaimer -->
                        <div class="disclaimer-note">
                            <strong>Lưu ý quan trọng:</strong>
                            <p>Phở Gõ Tarot không nhận trải bài cho các chủ đề sau: Sức khỏe, Bệnh tật, Pháp lý, Thi cử, Trúng số, hoặc các vấn đề 18+.</p>
                            <p>Dịch vụ cũng không dành cho người dưới 18 tuổi. Cảm ơn bạn đã thấu hiểu.</p>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </main>
    
    <script 
      type="application/ld+json" 
      slot="head"
      set:html={JSON.stringify(schema)}
    />

    <script is:inline>
        // Script xử lý form Google
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('contact-form');
            const iframe = document.getElementById('hidden_iframe');
            const successMessage = document.getElementById('form-success-message');
            const errorMessage = document.getElementById('form-error-message');
            const submitButton = document.getElementById('submit-button');
            let formSubmitted = false;

            if (form) {
                form.addEventListener('submit', function() {
                    // Vô hiệu hóa nút và hiển thị loading
                    submitButton.disabled = true;
                    submitButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Đang gửi...';
                    formSubmitted = true;
                    
                    // Reset trạng thái
                    successMessage.style.display = 'none';
                    errorMessage.style.display = 'none';

                    // Đặt một bộ đếm thời gian. Nếu iframe load thành công, nó sẽ hủy bộ đếm này
                    // Nếu không, bộ đếm sẽ kích hoạt lỗi
                    const errorTimeout = setTimeout(showError, 8000); // 8 giây timeout

                    iframe.onload = function() {
                        if (formSubmitted) {
                            clearTimeout(errorTimeout); // Hủy báo lỗi
                            showSuccess();
                        }
                    };
                });
            }

            function showSuccess() {
                successMessage.style.display = 'block';
                form.reset();
                resetButton();
                formSubmitted = false;
            }

            function showError() {
                errorMessage.style.display = 'block';
                resetButton();
                formSubmitted = false;
            }
            
            function resetButton() {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Gửi Đăng Ký';
            }
        });
    </script>

    <style>
        /* Mượn style cơ bản */
        .homepage-section { 
            padding: 4rem 1rem; 
            position: relative;
        }
        .container { 
            max-width: 1200px; 
            margin: auto; 
            padding: 0 1rem;
        }
        .section-title { 
            font-family: var(--font-title); 
            color: var(--title-color); 
            font-size: 3rem; 
            margin-bottom: 3rem; 
            text-align: center;
        }
        .section-subtitle { 
            font-family: var(--font-title); 
            color: var(--title-color); 
            font-size: 1.75rem;
            margin-top: 0; /* Reset cho cột */
            margin-bottom: 1.5rem;
        }
        .section-text { 
            font-size: 1rem;
            opacity: 0.9; 
            margin-bottom: 1.5rem; 
            text-shadow: none; 
            line-height: 1.8;
        }
        
        /* (MỚI) Layout 2 cột */
        .contact-layout-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 3rem;
        }
        @media (min-width: 900px) {
            .contact-layout-grid {
                grid-template-columns: 1fr 1.5fr; /* Cột form rộng hơn */
            }
        }
        
        /* (MỚI) Cột thông tin bên trái */
        .contact-info-list {
            list-style: none;
            padding: 0;
            margin: 2rem 0;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .contact-info-list li {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        .contact-info-list .info-icon {
            font-size: 1.25rem;
            color: var(--title-color);
            margin-top: 0.25rem;
            width: 20px;
            text-align: center;
        }
        .contact-info-list li div {
            display: flex;
            flex-direction: column;
        }
        .contact-info-list li strong {
            font-size: 0.9rem;
            opacity: 0.7;
            text-transform: uppercase;
        }
        .contact-info-list li a,
        .contact-info-list li span {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            text-decoration: none;
        }
        .contact-info-list li a:hover {
            color: var(--title-color);
        }

        /* (MỚI) Social links (mượn từ footer) */
        .contact-social-links {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .contact-social-links a {
            font-size: 1.75rem;
            color: var(--text-color);
            opacity: 0.7;
            transition: all 0.3s;
        }
        .contact-social-links a:hover {
            opacity: 1;
            color: var(--title-color);
            transform: scale(1.1);
        }

        /* (MỚI) Feedback box */
        .feedback-box {
            background-color: var(--button-bg);
            border: 1px solid var(--card-back-border);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .feedback-title {
            font-family: var(--font-title);
            color: var(--title-color);
            font-size: 1.25rem;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        /* (MỚI) Cột form bên phải */
        .contact-form-col {
            background-color: var(--card-back-bg);
            border: 1px solid var(--card-back-border);
            border-radius: 12px;
            padding: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
            opacity: 0.9;
        }
        .form-label .required {
            color: #ff8a8a; /* Màu đỏ cho dấu * */
            margin-left: 0.25rem;
        }
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.85rem 1rem;
            border-radius: 8px;
            background-color: var(--button-bg);
            border: 1px solid var(--card-back-border);
            color: var(--text-color);
            font-family: var(--font-body);
            font-size: 1rem;
            text-shadow: none;
            transition: all 0.3s;
        }
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--title-color);
            background-color: var(--bg-color);
        }
        .form-textarea {
            resize: vertical;
        }
        .form-hint {
            font-size: 0.85rem;
            opacity: 0.7;
            margin-top: 0.5rem;
            display: block;
        }
        
        /* Nút Submit (mượn từ index) */
        .btn-primary {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background-color: var(--title-color);
            color: var(--bg-color);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-shadow: none;
            width: 100%; /* Full width */
            justify-content: center;
        }
        .btn-primary:hover {
            background-color: #b8d4ff;
        }
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            background-color: var(--title-color);
        }

        /* (MỚI) Disclaimer note */
        .disclaimer-note {
            font-size: 0.9rem;
            opacity: 0.8;
            border-left: 3px solid var(--title-color);
            padding-left: 1rem;
            margin-top: 2rem;
            line-height: 1.7;
        }
        .disclaimer-note p {
            margin: 0.5rem 0 0 0;
            text-shadow: none;
        }
        .disclaimer-note strong {
            color: var(--title-color);
            font-size: 1rem;
        }

        /* (MỚI) Form Status Messages */
        .form-status-message {
            display: none;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            font-weight: 600;
            text-align: center;
        }
        .form-status-message.success {
            background-color: rgba(165, 214, 167, 0.2);
            border: 1px solid #a5d6a7;
            color: #a5d6a7;
        }
        .form-status-message.error {
            background-color: rgba(255, 138, 138, 0.2);
            border: 1px solid #ff8a8a;
            color: #ff8a8a;
        }
        
        @media (min-width: 600px) {
            .btn-primary {
                width: auto; /* Nút co lại trên desktop */
            }
        }
    </style>
</BaseLayout>