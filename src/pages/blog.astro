---
// 1. IMPORT (Thêm BaseLayout, giữ nguyên getCollection)
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// 2. LẤY DỮ LIỆU (Giữ nguyên)
const allPosts = await getCollection('blog');

// 3. (MỚI) Tạo dữ liệu cho JSON-LD (cho AI)
// Chúng ta tạo một danh sách các bài blog để báo cho AI biết
const blogPostListForAI = allPosts.map(post => ({
  "@type": "BlogPosting", // Loại nội dung là "Bài đăng Blog"
  "headline": post.data.title,
  "url": new URL(`/blog/${post.slug}`, Astro.site).href, // URL đầy đủ
  "image": new URL(post.data.image, Astro.site).href // URL ảnh bìa đầy đủ
}));
---

<BaseLayout
  title="Blog - Kiến Thức Tarot | Phở Gõ Tarot"
  description="Tổng hợp các bài viết mới nhất về ý nghĩa lá bài, các phương pháp luận giải và kiến thức tarot chuyên sâu từ Phở Gõ Tarot."
>
    <main id="homepage-content">
        <section class="homepage-section" style="padding-top: 6rem; min-height: 80vh;">
            <div class="container">
                <h2 class="section-title">Kiến Thức Tarot</h2>
                
                <div class="grid-3">
                    {allPosts.map(post => (
                        <div class="blog-card">
                            <img src={post.data.image} alt={post.data.title} class="section-image" />
                            <h3 class="section-subtitle">{post.data.title}</h3>
                            <p class="section-text">{post.data.excerpt}</p>
                            <a href={`/blog/${post.slug}`} class="btn-outline">Đọc tiếp &rarr;</a>
                        </div>
                    ))}
                </div>
            </div>
        </section>
    </main>
    
    <script type="application/ld+json" is:inline slot="head">
    {
      "@context": "https://schema.org",
      "@type": "Blog", // Báo cho AI biết đây là một trang Blog
      "name": "Blog - Kiến Thức Tarot | Phở Gõ Tarot",
      "description": "Tổng hợp các bài viết mới nhất về ý nghĩa lá bài, các phương pháp luận giải và kiến thức tarot chuyên sâu từ Phở Gõ Tarot.",
      "url": "https://phogotarot.com/blog",
      "isPartOf": { // Là một phần của website chính
        "@type": "WebSite",
        "url": "https://phogotarot.com/"
      },
      "blogPost": ${JSON.stringify(blogPostListForAI)} // Liệt kê các bài viết có trên trang
    }
    </script>

    <style>
        .section-title { font-family: var(--font-title); color: var(--title-color); font-size: 3rem; margin-bottom: 3rem; text-align: center; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .blog-card { border: 1px solid var(--card-back-border); background-color: var(--button-bg); padding: 1.5rem; border-radius: 12px; text-align: left; height: 100%; }
        .section-image { width: 100%; height: 200px; border-radius: 12px; object-fit: cover; margin-bottom: 1.5rem; }
        .section-subtitle { font-family: var(--font-title); color: var(--title-color); font-size: 1.25rem; margin-bottom: 1rem; }
        .section-text { font-size: 0.9rem; opacity: 0.8; margin-bottom: 1.5rem; text-shadow: none; }
        .btn-outline { display: inline-block; background: transparent; border: 1px solid var(--card-back-border); color: var(--title-color); padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; text-decoration: none; text-shadow: none; }
        .btn-outline:hover { background-color: var(--button-hover-bg); }
    </style>
</BaseLayout>